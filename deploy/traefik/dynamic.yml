http:
  serversTransports:
    backend-long-timeout:
      forwardingTimeouts:
        dialTimeout: "10s"
        responseHeaderTimeout: "120s"
        idleConnTimeout: "90s"

  middlewares:
    security-headers:
      headers:
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: "strict-origin-when-cross-origin"
        permissionsPolicy: "camera=(), microphone=(), geolocation=()"

  routers:
    # --- HTTP routers (port 80) ---
    api:
      entryPoints:
        - web
      rule: "PathPrefix(`/torrents`) || PathPrefix(`/settings/storage`) || PathPrefix(`/settings/player`) || PathPrefix(`/settings/encoding`) || PathPrefix(`/settings/hls`) || PathPrefix(`/watch-history`) || PathPrefix(`/swagger`) || PathPrefix(`/internal`) || PathPrefix(`/ws`)"
      service: torrentstream-api
      middlewares:
        - security-headers
      priority: 200

    search:
      entryPoints:
        - web
      rule: "PathPrefix(`/search`)"
      service: torrent-search-api
      middlewares:
        - security-headers
      priority: 190

    integrations:
      entryPoints:
        - web
      rule: "PathPrefix(`/settings/integrations`) || PathPrefix(`/api/v2`) || PathPrefix(`/widget`)"
      service: torrent-notifier-api
      middlewares:
        - security-headers
      priority: 195

    integrations-secure:
      entryPoints:
        - websecure
      rule: "PathPrefix(`/settings/integrations`) || PathPrefix(`/api/v2`) || PathPrefix(`/widget`)"
      service: torrent-notifier-api
      middlewares:
        - security-headers
      priority: 195
      tls: {}

    jackett:
      entryPoints:
        - web
      rule: "Host(`jackett.localhost`)"
      service: jackett-ui
      priority: 50

    prowlarr:
      entryPoints:
        - web
      rule: "Host(`prowlarr.localhost`)"
      service: prowlarr-ui
      priority: 50

    web:
      entryPoints:
        - web
      rule: "PathPrefix(`/`)"
      service: web-client
      middlewares:
        - security-headers
      priority: 1

    # --- HTTPS routers (port 443, HTTP/2) ---
    api-secure:
      entryPoints:
        - websecure
      rule: "PathPrefix(`/torrents`) || PathPrefix(`/settings/storage`) || PathPrefix(`/settings/player`) || PathPrefix(`/settings/encoding`) || PathPrefix(`/settings/hls`) || PathPrefix(`/watch-history`) || PathPrefix(`/swagger`) || PathPrefix(`/internal`) || PathPrefix(`/ws`)"
      service: torrentstream-api
      middlewares:
        - security-headers
      priority: 200
      tls: {}

    search-secure:
      entryPoints:
        - websecure
      rule: "PathPrefix(`/search`)"
      service: torrent-search-api
      middlewares:
        - security-headers
      priority: 190
      tls: {}

    web-secure:
      entryPoints:
        - websecure
      rule: "PathPrefix(`/`)"
      service: web-client
      middlewares:
        - security-headers
      priority: 1
      tls: {}

  services:
    torrentstream-api:
      loadBalancer:
        serversTransport: backend-long-timeout
        servers:
          - url: "http://torrentstream:8080"

    torrent-search-api:
      loadBalancer:
        serversTransport: backend-long-timeout
        servers:
          - url: "http://torrent-search:8090"

    torrent-notifier-api:
      loadBalancer:
        serversTransport: backend-long-timeout
        servers:
          - url: "http://torrent-notifier:8070"

    jackett-ui:
      loadBalancer:
        servers:
          - url: "http://jackett:9117"

    prowlarr-ui:
      loadBalancer:
        servers:
          - url: "http://prowlarr:9696"

    web-client:
      loadBalancer:
        servers:
          - url: "http://web-client:80"
